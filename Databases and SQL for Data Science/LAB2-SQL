------------------------------------------
--DDL statement for table 'HR' database--
--------------------------------------------

CREATE TABLE EMPLOYEES (
                            EMP_ID CHAR(9) NOT NULL, 
                            F_NAME VARCHAR(15) NOT NULL,
                            L_NAME VARCHAR(15) NOT NULL,
                            SSN CHAR(9),
                            B_DATE DATE,
                            SEX CHAR,
                            ADDRESS VARCHAR(30),
                            JOB_ID CHAR(9),
                            SALARY DECIMAL(10,2),
                            MANAGER_ID CHAR(9),
                            DEP_ID CHAR(9) NOT NULL,
                            PRIMARY KEY (EMP_ID));
                            
  CREATE TABLE JOB_HISTORY (
                            EMPL_ID CHAR(9) NOT NULL, 
                            START_DATE DATE,
                            JOBS_ID CHAR(9) NOT NULL,
                            DEPT_ID CHAR(9),
                            PRIMARY KEY (EMPL_ID,JOBS_ID));
 
 CREATE TABLE JOBS (
                            JOB_IDENT CHAR(9) NOT NULL, 
                            JOB_TITLE VARCHAR(15) ,
                            MIN_SALARY DECIMAL(10,2),
                            MAX_SALARY DECIMAL(10,2),
                            PRIMARY KEY (JOB_IDENT));

CREATE TABLE DEPARTMENTS (
                            DEPT_ID_DEP CHAR(9) NOT NULL, 
                            DEP_NAME VARCHAR(15) ,
                            MANAGER_ID CHAR(9),
                            LOC_ID CHAR(9),
                            PRIMARY KEY (DEPT_ID_DEP));

CREATE TABLE LOCATIONS (
                            LOCT_ID CHAR(9) NOT NULL,
                            DEP_ID_LOC CHAR(9) NOT NULL,
                            PRIMARY KEY (LOCT_ID,DEP_ID_LOC));
                            
                            
 -- Query 1 
 SELECT *
 FROM EMPLOYEES;
 
 SELECT *
 FROM EMPLOYEES
 WHERE ADDRESS like '%Elgin,IL';
                            
-- Query 2    
SELECT *
FROM EMPLOYEES
WHERE B_DATE like '197%';

-- Query 3    
SELECT *
FROM EMPLOYEES
WHERE SALARY BETWEEN 60000 AND 70000;

--QUERY 4A
SELECT *
FROM EMPLOYEES
ORDER BY EMP_ID;

-- QUERY 4B
SELECT *
FROM EMPLOYEES
ORDER BY DEP_ID DESC, L_NAME DESC;

--QUERY 5A 
SELECT DEP_ID, COUNT(*)
FROM EMPLOYEES
GROUP BY DEP_ID;

--QUERY 5B 
SELECT DEP_ID, COUNT(*), AVG(SALARY)
FROM EMPLOYEES
GROUP BY DEP_ID;

--QUERY 5C 
SELECT DEP_ID, COUNT(*) AS NUM_EMOLOYEES, AVG(SALARY) AS AVG_SALARY
FROM EMPLOYEES
GROUP BY DEP_ID;

--QUERY 5D 
SELECT DEP_ID, COUNT(*) AS NUM_EMOLOYEES, AVG(SALARY) AS AVG_SALARY
FROM EMPLOYEES
GROUP BY DEP_ID
ORDER BY AVG_SALARY;

--QUERY 5D 
SELECT DEP_ID, COUNT(*) AS NUM_EMOLOYEES, AVG(SALARY) AS AVG_SALARY
FROM EMPLOYEES
GROUP BY DEP_ID
HAVING COUNT(*)  < 4
ORDER BY AVG_SALARY;

--BONUS Query6--
select D.DEP_NAME , E.F_NAME, E.L_NAME
from EMPLOYEES as E, DEPARTMENTS as D
where E.DEP_ID = D.DEPT_ID_DEP
order by D.DEP_NAME, E.L_NAME desc ;

-- Sub-Queries and Nested Selects

-- EX1
SELECT EMP_ID, F_NAME, L_NAME, SALARY
FROM EMPLOYEES
WHERE SALARY < (SELECT AVG(SALARY) FROM EMPLOYEES);

-- EX2
SELECT EMP_ID, SALARY, (SELECT AVG(SALARY) FROM EMPLOYEES) AS AVG_SALARY
FROM EMPLOYEES;

-- EX3
SELECT * FROM (SELECT EMP_ID, F_NAME, L_NAME, DEP_ID FROM EMPLOYEES) AS EMP4ALL;

-- Working with multiple tables

-- EX1
SELECT * FROM EMPLOYEES
WHERE DEP_ID IN (SELECT DEP_ID FROM DEPARTMENTS);

-- EX2
SELECT * FROM EMPLOYEES
WHERE DEP_ID IN (SELECT DEP_ID FROM DEPARTMENTS WHERE LOC_ID='L0002');

-- EX3
SELECT DEPT_ID_DEP, DEP_NAME FROM DEPARTMENTS
WHERE DEPT_ID_DEP IN 
(SELECT DEP_ID FROM EMPLOYEES WHERE SALARY > 70000);

-- EX4: FULL JOIN 
SELECT * FROM EMPLOYEES, DEPARTMENTS;

-- EX5
SELECT * FROM EMPLOYEES E, DEPARTMENTS D 
WHERE E.DEP_ID = D.DEPT_ID_DEP;

-- EX6
SELECT E.EMP_ID, D.DEPT_ID_DEP 
FROM EMPLOYEES E, DEPARTMENTS D
WHERE E.DEP_ID = D.DEPT_ID_DEP;

----Join Operations 
---Query 1A: 

SELECT  F_NAME, L_NAME, START_DATE
FROM EMPLOYEES AS E
INNER JOIN JOB_HISTORY AS JH
ON E.EMP_ID = JH.EMPL_ID 
WHERE DEP_ID = 5;

---Query 1B: 
SELECT  F_NAME, L_NAME, START_DATE, JOB_TITLE 
FROM JOB_HISTORY AS JH
INNER JOIN EMPLOYEES AS E ON E.EMP_ID = JH.EMPL_ID
INNER JOIN JOBS AS JS ON JS.JOB_IDENT = JH.JOBS_ID
WHERE DEP_ID = 5;

-- Query 2A:
SELECT E.L_NAME, E.F_NAME, E.DEP_ID, D.DEP_NAME
FROM EMPLOYEES AS E 
LEFT JOIN DEPARTMENTS AS D 
ON E.DEP_ID = D.DEPT_ID_DEP;

--Query 2B:
SELECT E.L_NAME, E.F_NAME, E.DEP_ID, D.DEP_NAME
FROM EMPLOYEES AS E 
LEFT JOIN DEPARTMENTS AS D 
ON E.DEP_ID = D.DEPT_ID_DEP
WHERE year(E.B_DATE) < 1980;

-- Query 3A:
SELECT E.L_NAME, E.F_NAME, E.DEP_ID, D.DEP_NAME
FROM EMPLOYEES AS E 
FULL JOIN DEPARTMENTS AS D 
ON E.DEP_ID = D.DEPT_ID_DEP;

-- Query 3B
select E.F_NAME,E.L_NAME,D.DEPT_ID_DEP, D.DEP_NAME
from EMPLOYEES AS E 
FULL OUTER JOIN DEPARTMENTS AS D ON E.DEP_ID=D.DEPT_ID_DEP AND E.SEX = 'M'
